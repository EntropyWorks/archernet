<!doctype html>
<meta charset="utf-8">
<head>

<title>ARCHER NET</title>

<!-- Tags for setting default content when sharing on social media -->
<meta property="og:image" content="http://david733.github.io/archernet/ScreenClip.png" />
<meta property="og:title" content="ARCHER NET" />
<meta property="og:url" content="http://david733.github.io/archernet/" />
<meta property="og:description" content="A visualization of every shown or implied relationship between the character's of the FX show Archer." />

<!-- d3plus requires d3 libraries -->
<script src="js/d3.js"></script>
<script src="js/d3plus.js"></script>

<!-- Bootstrap styles for the tables -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">

<style>
    html, body { height: 100% }
    
    #viz { 
        height: 95%;
        min-height: 600px; /* to ensure that we have enough space to render the viz on a small screen, even if it requires scrolling */
        min-width: 780px;
    }
    
</style>
    
</head>
<body>
<div id="viz"></div>
<script>
    
    // This is the public feed generated by a custom standalone google apps script, which reads my Google Sheet with the links and returns a json
    var spreadsheetFeed = "https://script.googleusercontent.com/macros/echo?user_content_key=ZhqB5j46yAWp6LsLr3JHZxNZsGJBWBGI5RLVEeYc0JOhI6kuAUnaQfJXfe8sZIPHyhSRE985aKFlPb5oBhv6IeY8vhoD-_q2m5_BxDlH2jW0nuo2oDemN9CCS2h10ox_1xSncGQajx_ryfhECjZEnNAS8bcSZupmkgyj2XXo7TzjAqkUik2Rm9dXc9WvOL-D6lRmgTi-xah2nAfvGEgP6sTvy1m0tLyP&lib=Mvj_KMOWcSFAIrIiDR8vxz1kuA_MrNV96";
    
    
    var links, nodes;
    var edgeOpacities = {   'hookup': 0.4,
                            'relationship': 0.2,
                        };
    
    d3.json(spreadsheetFeed, function(graph) {
        
//      links = graph.links;        // this was used when reading from a static local json file
        links = graph;
        nodes = {};
        
        // Compute the distinct nodes from the links.
        links.forEach(function(link) {
            addNode(link.source, link, link.target);
            addNode(link.target, link, link.source);    
        });

        // Build the d3plus rings visualization
        var visualization = d3plus.viz()
        .container("#viz")
        .type("rings")
        .dev(false)        // set true to show more console log information
        .edges({           // use the links array to draw all the edges as grey lines with three levels of opacity
            "color": "#AAA",
            "opacity": function(d) {
                return edgeOpacities[d.type] ? edgeOpacities[d.type] : 0.1;
            },
            "value": links,
        })
        .data(d3.values(nodes))     // normally only edges are necessary, but we have some useful data encoded in each node object
        .tooltip({
            "html": function(d) {
                var neighbors = nodes[d].neighbors;
                var html = "<table class='table table-striped'>";        // show the focused node's primary neighbors on a styled table with some metadata for each
                html += "<tr><th>Partner</th><th>Type</th><th>Episode</th></tr>";
                neighbors.forEach(function(n) {
                    html += "<tr><td>" + n.name + "</td><td>" + n.link.type + "</td><td>" + n.link.episode + "</td></tr>";
                });
                html += "</table>";
                
                // so far this seemed the best place to stash the facebook share button
                html += '<iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fdavid733.github.io%2Farchernet%2F&amp;width&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;share=true&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; height:21px;" allowTransparency="true"></iframe>';
                return html;
            },
            "connections": false,  // we hide the normal primary connections list, which looks nice but doesn't let us show the extra metadata
            "large": 280,          // box width set to 280px
        })
        .size("degree")            // more connected nodes are larger
        .id("name")                // use names as node id's
        .focus("Sterling Archer")  // start with archer as the node in focus
        .title({                   // a footer with link, but more flexible than the actual footer function which does weird formatting
            "value": "A visualization of every shown or implied relationship between the character's of the FX show Archer. Will be updated occasionally as I catch up with new episodes. Powered by d3plus.js; click this footer for code and to suggest corrections. Â©2015 David Lee",
            "position": "bottom",
            "link": "https://github.com/david733/archernet",
            "font": {"size": 10},
        })
        .draw();
    });
    
    // Takes two names and creates a node object for the first, which remembers its relationship with the second name
    function addNode(n, link, m) {
        // Either creates a node or adds to an existing node
        if (!(n in nodes)) {
            nodes[n] = {};
            nodes[n].name = n;
            nodes[n].degree = 1;
            nodes[n].neighbors = [ {"name": m, "link": link} ];    // slightly overkill to store the whole link object as a property, but this gives some flexibility later on.
        }
        else {
            nodes[n].degree += 1;
            nodes[n].neighbors.push({"name": m, "link": link});
        }
    }

</script>
    
</body>